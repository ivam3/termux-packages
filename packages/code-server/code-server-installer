#!/data/data/com.termux/files/usr/bin/bash
IFS=$'\n\t'
v="v0.29.1"

case $(uname -m) in 
  aarch64) arch="arm64" ;;
  x86_64) arch="x64" ;;
esac

#yarn config set ignore-engines true //DEPRECATED
#yarn global add code-server --ignore-engines //DEPRECATED

wget https://github.com/ranisalt/node-argon2/releases/download/$v/argon2-$v-napi-v3-linux-$arch-glibc.tar.gz \
  -O ${TMPDIR}/argon2-$v-napi-v3-linux-$arch-glibc.tar.gz
[[ -d ${PREFIX}/lib/node_modules ]] || { mkdir -p ${PREFIX}/lib/node_modules;}
tar -xzvf argon2-$v-napi-v3-linux-$arch-glibc.tar.gz -C /data/data/com.termux/files/usr/lib/node_modules/
rm ${TMPDIR}/argon2-$v-napi-v3-linux-$arch-glibc.tar.gz
npm install --location=global --unsafe-perm code-server
for i in minimist yazl yauzl @microsoft/1ds-core-js
do
  npm install --location=global --unsafe-perm $i
done

echo -en "\e[33m[?] Set a login password:\e[0m "
while read passwd && [ -z $passwd ];do
  continue
done
[[ -d ${HOME}/.config/code-server ]] || {
  mkdir -p ${HOME}/.config/code-server;
}
cat <<- CONF > ${HOME}/.config/code-server/config.yaml
bind-addr: 127.0.0.1:8080
auth: password
password: $passwd
cert: false
CONF
exit 0
####::: REPORT ISSUES AT https://t.me/Ivam3_Bot :::####
