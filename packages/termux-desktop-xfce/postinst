#!/data/data/com.termux/files/usr/bin/bash
maindir=$(df|grep fuse|awk -F "/" '{print $NF}'|grep -iv emulated)
[[ -z $maindir ]] && { maindir="${HOME}";} || { maindir="$maindir/Android/data/com.termux/files";}
mkdir -p ${HOME}/Desktop $maindir/{Documents,downloads,Pictures,Public,Video}
for i in DocumentsÂ downloads Pictures Public Video;do
  ln -s $maindir/$i ${HOME}/$i 2>/dev/null
done

echo "Setting the Termux properties."
mkdir -p ${HOME}/.termux
curl -fsSL "https://raw.githubusercontent.com/ivam3/i-Haklab/master/.deb/home/.termux/termux.properties" \
  -o ${HOME}/.termux/termux.properties

echo "Setting x11 fonts ..."
mkdir -p ${PREFIX}/share/fonts/
curl -fsSL "https://github.com/ryanoasis/nerd-fonts/releases/download/$fontsV/ProFont.zip" \
  -o ${PREFIX}/share/fonts/ProFont.zip
[[ -e ${PREFIX}/share/fonts/ProFont.zip ]] && {
  unzip ${PREFIX}/share/fonts/ProFont.zip -d ${PREFIX}/share/fonts/
} || { echo "W: Fonts are unreachable.";}

echo "Downloading Termux Wayland apk (It could take a while) ..."
curl -fsSL "https://github.com/ivam3/termux-packages/raw/gh-pages/packages/termux-desktop-xfce/termux-x11.zip" \
  -o ${TMPDIR}/termux-x11.zip
[[ -e ${TMPDIR}/termux-x11.zip ]] && {
  mkdir -p ${TMPDIR}/desktmp && cd $_
  unzip -q ${TMPDIR}/termux-x11.zip -d ${TMPDIR}/desktmp/
  app=$(find ${TMPDIR}/desktmp/ -iname "*.apk")
  [[ ! -z $app ]] && {
    echo "Installing Termux Wayland apk (please accept the installation) ..."
    termux-open ${TMPDIR}/desktmp/$app
    sleep 10
  }
  echo "Installing submodules ..."
  git clone https://github.com/termux/termux-x11 ${PREFIX}/share/termux-x11 && cd $_
  git submodule update --init --recursive
} || { echo "E: Termux Wayland app missing ... Please install it manually.";}

rm -rf ${TMPDIR}/desktmp
curl -fsSL "https://raw.githubusercontent.com/ivam3/i-Haklab/master/.deb/home/.local/bin/fixer" \
    -o /data/data/com.termux/files/usr/bin/fixer
chmod 750 /data/data/com.termux/files/usr/bin/fixer
echo "[*] termux-desktop-xfce installation finished."
echo "[!] don't forget join to your device settings
    and bring to Termux Wayland app the permissions
    'run commands in Termux-app' & 'super potitions' too."
echo "[*] Run 'desktop' to execute it."
echo "[*] Run 'fixer' to fix any posible issue."
echo "[!] For help going to https://t.me/Ivam3_Bot."
echo "[*] @Ivam3: thank you for use my package."
####::: REPORT ISSUES AT https://t.me/Ivam3_Bot :::####
