#!/data/data/com.termux/files/usr/bin/bash
maindir=$(df|grep fuse|awk -F "/" '{print $NF}'|grep -iv emulated)
[[ -z $maindir ]] && { maindir="${HOME}";} || { maindir="$maindir/Android/data/com.termux/files";}
mkdir -p ${HOME}/Desktop $maindir/{Documents,downloads,Pictures,Public,Video}
for i in DocumentsÂ downloads Pictures Public Video;do
  ln -s $maindir/$i ${HOME}/$i 2>/dev/null
done

echo "Setting the Termux properties."
mkdir -p ${HOME}/.termux
wget --tries=20 --quiet https://raw.githubusercontent.com/ivam3/i-Haklab/master/.deb/home/.termux/termux.properties \
  -O ${HOME}/.termux/termux.properties

echo "Setting x11 fonts ..."
mkdir -p ${PREFIX}/share/fonts/
wget --tries=20 --quiet https://github.com/ryanoasis/nerd-fonts/releases/download/$fontsV/ProFont.zip \
  -O ${PREFIX}/share/fonts/ProFont.zip
[[ -e ${PREFIX}/share/fonts/ProFont.zip ]] && {
  unzip ${PREFIX}/share/fonts/ProFont.zip -d ${PREFIX}/share/fonts/
} || { echo "W: Fonts are unreachable.";}

echo "Downloading Termux Wayland apk (It could take a while) ..."
wget --tries=20 --quiet https://github.com/ivam3/termux-packages/raw/gh-pages/packages/termux-desktop-xfce/termux-x11.zip \
  -O ${TMPDIR}/termux-x11.zip
[[ -e ${TMPDIR}/termux-x11.zip ]] && {
  mkdir -p ${TMPDIR}/desktmp
  unzip -q ${TMPDIR}/termux-x11.zip -d ${TMPDIR}/desktmp/ && cd $_
  app=$(find ${TMPDIR}/desktmp/ -iname "*.apk")
  deb=$(find ${TMPDIR}/desktmp/ -iname "*.deb")
  [[ ! -z $app ]] && {
    echo "Installing Termux Wayland apk (please accept the installation) ..."
    termux-open ${TMPDIR}/desktmp/$app
    sleep 10
  }
  [[ ! -z $deb ]] && {
    echo "Uncompressing & installing debs files."
    ar -x $deb
    tar=$(find ${TMPDIR}/desktmp/ -iname "*.tar.xz")
    tar -xvf $tar
    find data -type d -exec mkdir -p "{}" \;
    declare -a d=$(find data -mindepth 5 -type d)
    declare -a f=$(find data -mindepth 5 -type f)
    for file in ${f[*]}; do
        cp "$f" "/$file"
    done
  }
} || { echo "E: Termux Wayland app missing ... Please install it manually.";}
rm -rf ${TMPDIR}/*


wget --tries=20 --quiet https://raw.githubusercontent.com/ivam3/i-Haklab/master/.deb/home/.local/bin/fixer -O /data/data/com.termux/files/usr/bin/fixer
chmod 750 /data/data/com.termux/files/usr/bin/fixer
echo "[*] termux-desktop-xfce installation finished."
echo "[!] don't forget join to your device settings
    and bring to Termux Wayland app the permissions
    'run commands in Termux-app' & 'super potitions' too."
echo "[*] Run 'termux-desktop-xfce' to execute it."
echo "[*] Run 'fixer' to fix any posible issue."
echo "[!] For help going to https://t.me/Ivam3_Bot."
echo "[*] @Ivam3: thank you for use my package."
####::: REPORT ISSUES AT https://t.me/Ivam3_Bot :::####
