#!/data/data/com.termux/files/usr/bin/bash
IFS=$'\n\t'
trap ctrl_c 2

export DISPLAY=:0
export XDG_RUNTIME_DIR=${TMPDIR}
export XKB_CONFIG_ROOT=${PREFIX}/share/xkeyboard-config-2/

! command -v termux-x11 >/dev/null && { yes|apt install termux-x11-nightly
} || ! command -v Xwayland >/dev/null && { yes|apt install xwayland
} && { 
    echo -en "\e[31mE:\e[0m Installing termux-x11 submodules."
    git clone https://github.com/termux/termux-x11 ${PREFIX}/share/termux-x11 && cd $_
    git submodule update --init --recursive
}

pulseaudio --start --exit-idle-time=-1 2>/dev/null
pacmd load-module module-native-protocol-tcp auth-ip-acl=127.0.0.1 auth-anonymous=1

am start -n com.termux.x11/com.termux.x11.MainActivity;sleep 3
[[ ! -z "$1" ]] && [[ "$1" == "Xwayland" ]] && { Xbin="$1";} || { Xbin="termux-x11";tip="Xwayland";}
$(command -v $Xbin) :0 >/dev/null &
sleep 6;xfce4-session --display=$DISPLAY || echo -en "\e[31mE: Display unrechable \e[0m|\e[33m Try it with: \e[32m$(basename $0) $tip\e[0m"

killall main pulseaudio 2>/dev/null
####::: REPORT ISSUES AT https://t.me/Ivam3_Bot :::####
