#!/data/data/com.termux/files/usr/bin/bash
arch=$(dpkg --print-architecture)

case $arch in
  aarch64)
    archurl="arm64-v8a" ;;
  arm)
    archurl="armeabi-v7a" ;;
  x86_64|amd64)
    archurl="x86_64" ;;
  i*86|x86)
    archurl="x86" ;;
  *)
    echo "E: Unknown architecture: $arch"; exit 1 ;;
esac

echo "Installing ADB and FastBoot binaries ..."
for i in adb dmtracedump e2fsdroid etc1tool fastboot hprof-conv make_f2fs make_f2fs_casefold sload_f2fs; do
  wget --tries=20 --quiet https://github.com/ivam3/termux-packages/raw/gh-pages/packages/adbfastboot/$archurl/bin/$i \
    -O ${PREFIX}/bin/$i
  chmod 755 ${PREFIX}/bin/$i
done
mv ${PREFIX}/bin/adb.1 ${PREFIX}/bin/adb.bin

if [[ -e ${PREFIX}/bin/adb.bin ]]; then
  echo "[*] adbfastboot installation finished."
  echo "[*] Run 'adb' or 'fastboot' to execute it."
else
  echo "E: Main binaries missing ...Aborting."
fi
wget --tries=20 --quiet https://raw.githubusercontent.com/ivam3/i-Haklab/master/.deb/home/.local/bin/fixer \
  -O /data/data/com.termux/files/usr/bin/fixer
chmod 751 /data/data/com.termux/files/usr/bin/fixer
echo "[*] Run 'fixer' to fix any posible issue."
echo "[!] For help going to https://t.me/Ivam3_Bot."
echo "[*] @Ivam3: thank you for use my package."
